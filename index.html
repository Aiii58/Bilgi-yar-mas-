<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bilgi YarÄ±ÅŸmasÄ±">
<meta name="theme-color" id="mtc" content="#07070f">
<title>Bilgi YarÄ±ÅŸmasÄ±</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap');
body{
  --bg:#07070f;--sf:#0f0f1a;--sf2:#161625;--sf3:#1e1e32;
  --bd:#282845;--pr:#6c5ce7;--prl:#a29bfe;--prb:rgba(108,92,231,.12);
  --ac:#fd79a8;--ac2:#00cec9;--ac3:#fdcb6e;
  --tx:#eaeaf4;--txd:#9090b0;--txm:#5a5a7a;
  --ok:#00b894;--no:#ff6b6b;--star:#f9ca24;
  --r:16px;--rs:10px;
}
body.light{
  --bg:#f2f3f8;--sf:#fff;--sf2:#f7f7fd;--sf3:#ededf5;
  --bd:#d0d0e2;--prl:#5a4bd6;--prb:rgba(108,92,231,.08);
  --tx:#1a1a30;--txd:#55557a;--txm:#8888a8;
  --ok:#00a884;--no:#e74c3c;--star:#d4940e;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 25% 15%,rgba(108,92,231,.06) 0%,transparent 55%),radial-gradient(ellipse at 75% 85%,rgba(253,121,168,.04) 0%,transparent 55%);pointer-events:none;z-index:0}

.app{position:relative;z-index:1;max-width:720px;margin:0 auto;padding:12px 14px 90px}

/* Header */
.hdr{text-align:center;padding:18px 12px 14px}
.hdr-top{display:flex;justify-content:flex-end;margin-bottom:8px}
.theme-btn{width:46px;height:46px;border:1.5px solid var(--bd);background:var(--sf);border-radius:14px;font-size:1.3rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.hdr h1{font-size:1.65rem;font-weight:900;background:linear-gradient(135deg,#a29bfe,#fd79a8,#fdcb6e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sbar{display:flex;justify-content:center;gap:16px;margin-top:10px;flex-wrap:wrap}
.si{text-align:center}
.sn{font-family:'JetBrains Mono',monospace;font-size:1.15rem;font-weight:700;color:var(--prl)}
.sl{font-size:.58rem;color:var(--txm);text-transform:uppercase;letter-spacing:1.2px;font-weight:700}

/* Nav */
.nav{display:flex;gap:3px;padding:5px;background:var(--sf);border-radius:var(--r);border:1px solid var(--bd);margin-bottom:14px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.nav::-webkit-scrollbar{display:none}
.nb{flex:1;min-width:0;padding:9px 4px;border:none;background:transparent;color:var(--txd);font-family:'Nunito',sans-serif;font-size:.67rem;font-weight:700;border-radius:var(--rs);cursor:pointer;white-space:nowrap;display:flex;flex-direction:column;align-items:center;gap:2px}
.nb .ic{font-size:1.1rem}.nb.on{background:var(--pr);color:#fff;box-shadow:0 4px 14px rgba(108,92,231,.35)}

/* Sections */
.sec{display:none;animation:fu .3s}.sec.on{display:block}
@keyframes fu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Card */
.cd{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:16px;margin-bottom:12px}
.ct{font-size:.9rem;font-weight:800;margin-bottom:14px;display:flex;align-items:center;gap:8px}

/* Form */
.fg{margin-bottom:13px}
.fl{display:block;font-size:.7rem;font-weight:700;color:var(--txd);margin-bottom:5px;text-transform:uppercase;letter-spacing:.8px}
input[type=text],input[type=number],select,textarea{
  width:100%;padding:11px 13px;background:var(--sf2);border:1.5px solid var(--bd);border-radius:var(--rs);
  color:var(--tx);font-family:'Nunito',sans-serif;font-size:.86rem;font-weight:500;outline:none;
  -webkit-appearance:none;appearance:none;
}
input:focus,select:focus,textarea:focus{border-color:var(--pr);box-shadow:0 0 0 3px var(--prb)}
textarea{resize:vertical;min-height:80px}
select{cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239090b0' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:34px}
select option{background:var(--sf);color:var(--tx)}

/* Buttons - ALL buttons/clickable get cursor:pointer for iOS */
button,[data-act]{cursor:pointer;-webkit-tap-highlight-color:transparent}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:11px 20px;border:none;border-radius:var(--rs);font-family:'Nunito',sans-serif;font-size:.83rem;font-weight:700;cursor:pointer}
.btn:active{transform:scale(.97)}
.bp{background:linear-gradient(135deg,#6c5ce7,#8575f7);color:#fff;box-shadow:0 4px 14px rgba(108,92,231,.3)}
.bs{background:var(--ok);color:#fff}.bd{background:var(--no);color:#fff}.bw{background:var(--star);color:#1a1a2e}
.bo{background:transparent;border:1.5px solid var(--bd);color:var(--txd)}.bsm{padding:8px 14px;font-size:.75rem}
.bbl{width:100%}.bg{display:flex;gap:8px;flex-wrap:wrap}

/* MC options form */
.opts{display:flex;flex-direction:column;gap:8px}
.orow{display:flex;gap:8px;align-items:center}
.oltr{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--sf3);border-radius:50%;font-size:.7rem;font-weight:800;color:var(--txd);flex-shrink:0}
.orow input[type=text]{flex:1}
.crd{width:22px;height:22px;appearance:none;-webkit-appearance:none;border:2.5px solid var(--bd);border-radius:50%;cursor:pointer;flex-shrink:0;background:transparent}
.crd:checked{border-color:var(--ok);background:var(--ok);box-shadow:inset 0 0 0 3px var(--sf2)}

/* Audio */
.az{background:var(--sf2);border:2px dashed var(--bd);border-radius:var(--r);padding:20px 14px;text-align:center;margin-bottom:13px}
.az.has{border-color:var(--ac);border-style:solid}
.abtn{display:flex;justify-content:center;gap:10px;margin-top:12px;flex-wrap:wrap}
.rbtn{width:50px;height:50px;border-radius:50%;border:3px solid var(--ac);background:transparent;color:var(--ac);font-size:1.2rem;cursor:pointer}
.rbtn.rc{background:var(--no);border-color:var(--no);color:#fff;animation:pls 1s infinite}
@keyframes pls{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
.ubtn{display:inline-flex;align-items:center;gap:5px;padding:9px 16px;background:var(--sf3);border:1.5px solid var(--bd);border-radius:22px;color:var(--txd);font-family:'Nunito',sans-serif;font-size:.76rem;font-weight:600;cursor:pointer}

/* Q List */
.qi{display:flex;align-items:center;gap:10px;padding:12px 13px;background:var(--sf);border:1px solid var(--bd);border-radius:var(--rs);margin-bottom:7px;cursor:pointer}
.qi.st{border-left:3px solid var(--star)}
.qic{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:.95rem;flex-shrink:0}
.qic-m{background:rgba(108,92,231,.12)}.qic-c{background:rgba(0,206,201,.12)}.qic-a{background:rgba(253,121,168,.12)}
.qif{flex:1;min-width:0}
.qif .qt{font-size:.82rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.qif .qm{font-size:.66rem;color:var(--txm);margin-top:1px;font-weight:600}
.qac{display:flex;gap:3px;flex-shrink:0}
.qb{width:33px;height:33px;border:none;background:var(--sf2);color:var(--txd);border-radius:8px;cursor:pointer;font-size:.8rem;display:flex;align-items:center;justify-content:center}
.qb.sa{color:var(--star);background:rgba(249,202,36,.12)}

/* Quiz */
.qpg{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.pbr{flex:1;height:7px;background:var(--sf3);border-radius:4px;overflow:hidden}
.pfl{height:100%;background:linear-gradient(90deg,var(--pr),var(--ac));border-radius:4px;transition:width .4s}
.ptx{font-family:'JetBrains Mono',monospace;font-size:.76rem;color:var(--txd);white-space:nowrap;font-weight:600}
.qqc{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:22px 18px;margin-bottom:14px;text-align:center}
.qqc .qn{font-size:.66rem;color:var(--txm);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:10px;font-weight:700}
.qqc .qtx{font-size:1.08rem;font-weight:700;line-height:1.55}
.qop{display:flex;align-items:center;gap:12px;padding:13px 15px;background:var(--sf);border:2px solid var(--bd);border-radius:var(--rs);margin-bottom:7px;cursor:pointer;font-size:.88rem;font-weight:500}
.qop.sel{border-color:var(--pr);background:var(--prb)}.qop.ok{border-color:var(--ok);background:rgba(0,184,148,.1)}.qop.no{border-color:var(--no);background:rgba(255,107,107,.1)}
.qop .ol{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--sf3);font-weight:800;font-size:.76rem;flex-shrink:0}
.qin{width:100%;padding:15px;background:var(--sf);border:2px solid var(--bd);border-radius:var(--rs);color:var(--tx);font-family:'Nunito',sans-serif;font-size:1rem;font-weight:600;text-align:center;outline:none;margin-bottom:12px}
.qin:focus{border-color:var(--pr)}

/* Results */
.rsc{font-family:'JetBrains Mono',monospace;font-size:3.2rem;font-weight:900;background:linear-gradient(135deg,var(--ok),var(--ac2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.rbd{display:flex;justify-content:center;gap:26px;margin:18px 0}
.ri .rn{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:700}.ri .rl{font-size:.66rem;color:var(--txm);text-transform:uppercase;font-weight:700}
.ri.ck .rn{color:var(--ok)}.ri.cn .rn{color:var(--no)}

/* IO */
.ioc{display:flex;align-items:center;gap:14px;padding:16px;background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:10px;cursor:pointer}
.ioi{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}

/* Filter */
.fb{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.fb input[type=text]{flex:1;min-width:120px;padding:10px 13px;font-size:.8rem}
.fb select{width:auto;min-width:100px;padding:10px 32px 10px 11px;font-size:.8rem}

/* Config */
.cfg{display:flex;flex-direction:column;gap:11px}
.cfo{display:flex;align-items:center;justify-content:space-between;padding:12px 15px;background:var(--sf2);border:1px solid var(--bd);border-radius:var(--rs)}
.cfo label{font-size:.84rem;font-weight:600}
.tog{position:relative;width:44px;height:25px;background:var(--sf3);border-radius:13px;cursor:pointer;flex-shrink:0}
.tog.on{background:var(--pr)}
.tog::after{content:'';position:absolute;top:3px;left:3px;width:19px;height:19px;background:#fff;border-radius:50%;transition:transform .3s}
.tog.on::after{transform:translateX(19px)}

/* Bulk */
.binfo{background:var(--sf2);border:1px solid var(--bd);border-radius:var(--rs);padding:13px;font-size:.74rem;color:var(--txd);margin-bottom:13px;line-height:1.6}
.binfo code{display:block;background:var(--sf3);padding:9px 11px;border-radius:8px;margin:7px 0;font-family:'JetBrains Mono',monospace;font-size:.68rem;white-space:pre-wrap;color:var(--tx);line-height:1.5}
.trow{display:flex;gap:4px;margin-bottom:13px}
.tb{flex:1;padding:10px;border:1.5px solid var(--bd);background:var(--sf2);color:var(--txd);font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:700;border-radius:var(--rs);cursor:pointer}
.tb.on{border-color:var(--pr);color:var(--pr);background:var(--prb)}

.sbd{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;background:rgba(249,202,36,.12);border-radius:20px;font-size:.68rem;color:var(--star);font-weight:700}

/* Empty */
.emp{text-align:center;padding:40px 20px;color:var(--txm)}
.emp .eic{font-size:2.6rem;margin-bottom:8px;opacity:.5}

/* Toast */
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:11px 20px;font-size:.82rem;font-weight:600;z-index:9999;transition:transform .3s;box-shadow:0 8px 32px rgba(0,0,0,.4)}
.toast.show{transform:translateX(-50%) translateY(0)}.toast.ok{border-color:var(--ok)}.toast.er{border-color:var(--no)}

/* Modal */
.mov{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:1000;display:none;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(6px)}
.mov.show{display:flex}
.mdl{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:20px;max-width:500px;width:100%;max-height:85vh;overflow-y:auto}
.mdl h3{margin-bottom:13px;font-size:1rem;font-weight:800}

.hid{display:none!important}
@media(max-width:600px){.app{padding:8px 10px 85px}.hdr h1{font-size:1.35rem}.sn{font-size:1rem}.sbar{gap:11px}}
</style>
<script>
// Pre-render theme
if(localStorage.getItem('qt')==='light')document.write('<style>body{--bg:#f2f3f8!important;--sf:#fff!important;--sf2:#f7f7fd!important;--sf3:#ededf5!important;--bd:#d0d0e2!important;--tx:#1a1a30!important;--txd:#55557a!important;--txm:#8888a8!important;--prl:#5a4bd6!important;--prb:rgba(108,92,231,.08)!important;--ok:#00a884!important;--no:#e74c3c!important;--star:#d4940e!important}</style>');
</script>
</head>
<body>
<div class="app">
  <div class="hdr">
    <div class="hdr-top"><button class="theme-btn" id="tBtn" data-act="theme">ğŸŒ™</button></div>
    <h1>ğŸ§  Bilgi YarÄ±ÅŸmasÄ±</h1>
    <div class="sbar">
      <div class="si"><div class="sn" id="sT">0</div><div class="sl">Toplam</div></div>
      <div class="si"><div class="sn" id="sM">0</div><div class="sl">ÅÄ±klÄ±</div></div>
      <div class="si"><div class="sn" id="sC">0</div><div class="sl">Klasik</div></div>
      <div class="si"><div class="sn" id="sA">0</div><div class="sl">Sesli</div></div>
      <div class="si"><div class="sn" id="sS" style="color:var(--star)">0</div><div class="sl">YÄ±ldÄ±zlÄ±</div></div>
    </div>
  </div>

  <div class="nav" id="nav">
    <button class="nb on" data-tab="questions"><span class="ic">ğŸ“‹</span>Sorular</button>
    <button class="nb" data-tab="starred"><span class="ic">â­</span>YÄ±ldÄ±zlÄ±</button>
    <button class="nb" data-tab="add"><span class="ic">â•</span>Ekle</button>
    <button class="nb" data-tab="quiz"><span class="ic">ğŸ®</span>YarÄ±ÅŸma</button>
    <button class="nb" data-tab="io"><span class="ic">ğŸ’¾</span>Aktar</button>
  </div>

  <!-- SORULAR -->
  <div class="sec on" id="sec-questions">
    <div class="fb">
      <input type="text" id="srcI" placeholder="ğŸ” Soru ara...">
      <select id="fTy"><option value="all">TÃ¼mÃ¼</option><option value="mc">ÅÄ±klÄ±</option><option value="classic">Klasik</option><option value="audio">Sesli</option></select>
      <select id="fCa"><option value="all">TÃ¼m Kategoriler</option></select>
    </div>
    <div id="qL"></div>
  </div>

  <!-- YILDIZLI -->
  <div class="sec" id="sec-starred">
    <div class="cd" style="padding:13px 16px;margin-bottom:12px">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px">
        <div style="display:flex;align-items:center;gap:8px"><span style="font-size:1.2rem">â­</span><span style="font-weight:800;font-size:.9rem">YÄ±ldÄ±zlÄ± Sorular</span><span class="sbd" id="sBd">0</span></div>
        <button class="btn bw bsm" data-act="starquiz">ğŸ® YÄ±ldÄ±zlÄ±larla YarÄ±ÅŸ</button>
      </div>
    </div>
    <div id="sL"></div>
  </div>

  <!-- EKLE -->
  <div class="sec" id="sec-add">
    <div class="trow">
      <button class="tb on" data-act="addmode" data-mode="single">ğŸ“ Tekli Ekle</button>
      <button class="tb" data-act="addmode" data-mode="bulk">ğŸ“‹ Toplu Ekle</button>
    </div>
    <div id="singleAdd">
      <div class="cd">
        <div class="ct">Yeni Soru Ekle</div>
        <div class="fg"><label class="fl">Soru Tipi</label><select id="aType"><option value="mc">ğŸ“ ÅÄ±klÄ±</option><option value="classic">âœï¸ Klasik</option><option value="audio">ğŸµ Sesli</option></select></div>
        <div class="fg"><label class="fl">Kategori</label><input type="text" id="aCat" placeholder="Ã–rn: Tarih, CoÄŸrafya..." list="cdl"><datalist id="cdl"></datalist></div>
        <div class="fg"><label class="fl">Soru Metni</label><textarea id="aQ" placeholder="Sorunuzu yazÄ±n..."></textarea></div>
        <div id="mcO">
          <label class="fl">ÅÄ±klar <span style="font-weight:400;color:var(--txm)">(doÄŸruyu iÅŸaretleyin)</span></label>
          <div class="opts" id="opC">
            <div class="orow"><div class="oltr">A</div><input type="text" placeholder="A ÅŸÄ±kkÄ±"><input type="radio" name="co" value="0" class="crd" checked></div>
            <div class="orow"><div class="oltr">B</div><input type="text" placeholder="B ÅŸÄ±kkÄ±"><input type="radio" name="co" value="1" class="crd"></div>
            <div class="orow"><div class="oltr">C</div><input type="text" placeholder="C ÅŸÄ±kkÄ±"><input type="radio" name="co" value="2" class="crd"></div>
            <div class="orow"><div class="oltr">D</div><input type="text" placeholder="D ÅŸÄ±kkÄ±"><input type="radio" name="co" value="3" class="crd"></div>
          </div>
        </div>
        <div id="clA" class="hid">
          <div class="fg"><label class="fl">DoÄŸru Cevap</label><input type="text" id="aAns" placeholder="Cevap..."></div>
          <div class="fg"><label class="fl">Ä°pucu</label><input type="text" id="aHint" placeholder="Ä°pucu..."></div>
        </div>
        <div id="auS" class="hid">
          <div class="az" id="aZ">
            <div style="font-size:2rem;margin-bottom:5px">ğŸ¤</div>
            <p style="font-size:.74rem;color:var(--txd)">Ses kaydÄ± veya dosya yÃ¼kleyin</p>
            <p style="font-size:.66rem;color:var(--txm);margin-top:2px">MP3, M4A, WAV, OGG, AAC</p>
            <div class="abtn">
              <button class="rbtn" id="rBtn" data-act="rec">âº</button>
              <button class="ubtn" data-act="aufile">ğŸ“ Dosya YÃ¼kle</button>
              <input type="file" id="auF" class="hid" accept="audio/*,.mp3,.m4a,.wav,.ogg,.aac,.wma,.flac,.opus,.webm">
            </div>
            <div id="auN" class="hid" style="font-size:.72rem;color:var(--ac);margin-top:6px;font-weight:600"></div>
            <audio id="auP" controls class="hid" style="width:100%;margin-top:10px"></audio>
          </div>
          <div class="fg"><label class="fl">DoÄŸru Cevap</label><input type="text" id="aAuA" placeholder="Cevap..."></div>
        </div>
        <div style="margin-top:16px"><button class="btn bp bbl" data-act="save" id="svB">ğŸ’¾ Soruyu Kaydet</button></div>
      </div>
    </div>
    <div id="bulkAdd" class="hid">
      <div class="cd">
        <div class="ct">ğŸ“‹ Toplu Soru Ekle</div>
        <div class="binfo">Her satÄ±ra bir soru:<code>ÅIKLI: Soru? | A | B | C | D | DoÄŸru(A/B/C/D)
KLASÄ°K: Soru? | Cevap
KLASÄ°K: Soru? | Cevap | Ä°pucu</code>Otomatik algÄ±lama da Ã§alÄ±ÅŸÄ±r:<code>BaÅŸkent neresi? | Ankara | Ä°stanbul | Ä°zmir | Bursa | A
BÃ¼yÃ¼k okyanus? | BÃ¼yÃ¼k Okyanus</code></div>
        <div class="fg"><label class="fl">Kategori</label><input type="text" id="bCat" placeholder="Genel KÃ¼ltÃ¼r" list="cdl"></div>
        <div class="fg"><label class="fl">SorularÄ± YapÄ±ÅŸtÄ±rÄ±n</label><textarea id="bTxt" placeholder="Her satÄ±ra bir soru..." style="min-height:180px;font-size:.78rem"></textarea></div>
        <div id="bPrev" class="hid" style="margin-bottom:13px"></div>
        <div class="bg"><button class="btn bo" data-act="bprev">ğŸ‘ï¸ Ã–nizle</button><button class="btn bp bbl" data-act="bsave">ğŸ’¾ Toplu Kaydet</button></div>
      </div>
    </div>
  </div>

  <!-- YARIÅMA -->
  <div class="sec" id="sec-quiz">
    <div id="qSt">
      <div class="cd">
        <div class="ct">ğŸ® YarÄ±ÅŸma AyarlarÄ±</div>
        <div class="cfg">
          <div class="fg"><label class="fl">Soru SayÄ±sÄ±</label><input type="number" id="qCn" value="10" min="1" max="999"></div>
          <div class="fg"><label class="fl">Soru Tipi</label><select id="qTy"><option value="all">TÃ¼m Tipler</option><option value="mc">ÅÄ±klÄ±</option><option value="classic">Klasik</option><option value="audio">Sesli</option></select></div>
          <div class="fg"><label class="fl">Kategori</label><select id="qCa"><option value="all">TÃ¼m Kategoriler</option></select></div>
          <div class="cfo"><label>SorularÄ± KarÄ±ÅŸtÄ±r</label><div class="tog on" id="tSh" data-act="tog"></div></div>
          <div class="cfo"><label>â­ Sadece YÄ±ldÄ±zlÄ±lar</label><div class="tog" id="tSt" data-act="tog"></div></div>
        </div>
        <div style="margin-top:16px"><button class="btn bp bbl" data-act="startq">ğŸš€ BaÅŸlat</button></div>
      </div>
    </div>
    <div id="qPl" class="hid">
      <div class="qpg"><div class="pbr"><div class="pfl" id="pF"></div></div><div class="ptx" id="pT">1/10</div></div>
      <div id="qCo"></div>
      <div id="qAc" style="margin-top:14px;text-align:center"></div>
    </div>
    <div id="qRe" class="hid"></div>
  </div>

  <!-- AKTAR -->
  <div class="sec" id="sec-io">
    <div class="ioc" data-act="export"><div class="ioi" style="background:rgba(0,184,148,.12)">ğŸ“¤</div><div><div style="font-size:.88rem;font-weight:700">DÄ±ÅŸa Aktar</div><div style="font-size:.73rem;color:var(--txd);margin-top:2px">JSON olarak indir</div></div></div>
    <div class="ioc" data-act="import"><div class="ioi" style="background:rgba(108,92,231,.12)">ğŸ“¥</div><div><div style="font-size:.88rem;font-weight:700">Ä°Ã§e Aktar</div><div style="font-size:.73rem;color:var(--txd);margin-top:2px">JSON dosyasÄ±ndan yÃ¼kle</div></div></div>
    <input type="file" id="impF" class="hid" accept=".json">
    <div class="cd" style="margin-top:14px"><div class="ct">âš ï¸ Tehlikeli BÃ¶lge</div><p style="font-size:.78rem;color:var(--txd);margin-bottom:10px">Geri alÄ±namaz.</p><button class="btn bd bsm" data-act="clearall">ğŸ—‘ï¸ TÃ¼m SorularÄ± Sil</button></div>
    <div class="cd" style="margin-top:10px"><div class="ct">â„¹ï¸ Depolama</div><p style="font-size:.78rem;color:var(--txd)" id="stI">YÃ¼kleniyor...</p></div>
  </div>
</div>

<div class="toast" id="tst"></div>
<div class="mov" id="mOv"><div class="mdl" id="mCt"></div></div>

<script>
(function(){
// â•â•â• UTILS â•â•â•
var $=function(id){return document.getElementById(id)};
function esc(s){var d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2,6)}
function fmtD(iso){if(!iso)return'';try{return new Date(iso).toLocaleDateString('tr-TR',{day:'numeric',month:'short',year:'numeric'})}catch(e){return''}}
function toast(m,t){var e=$('tst');e.textContent=m;e.className='toast '+(t==='error'?'er':'ok')+' show';setTimeout(function(){e.classList.remove('show')},2500)}

// â•â•â• THEME â•â•â•
function applyTheme(){
  var isL=localStorage.getItem('qt')==='light';
  if(isL){document.body.classList.add('light')}else{document.body.classList.remove('light')}
  $('tBtn').textContent=isL?'â˜€ï¸':'ğŸŒ™';
  $('mtc').content=isL?'#f2f3f8':'#07070f';
}
applyTheme();

// â•â•â• DB â•â•â•
var DB='BilgiYarismasi',VER=2,ST='questions',db=null;
function openDB(){return new Promise(function(r,j){var q=indexedDB.open(DB,VER);q.onupgradeneeded=function(e){var d=e.target.result;if(!d.objectStoreNames.contains(ST)){var s=d.createObjectStore(ST,{keyPath:'id'});s.createIndex('type','type');s.createIndex('category','category');s.createIndex('starred','starred')}else{var s=e.currentTarget.transaction.objectStore(ST);if(!s.indexNames.contains('starred'))s.createIndex('starred','starred')}};q.onsuccess=function(e){db=e.target.result;r(db)};q.onerror=function(e){j(e.target.error)}})}
function xt(m){return db.transaction(ST,m||'readonly').objectStore(ST)}
function dbAll(){return new Promise(function(r,j){var q=xt().getAll();q.onsuccess=function(){r(q.result)};q.onerror=function(){j(q.error)}})}
function dbPut(i){return new Promise(function(r,j){var q=xt('readwrite').put(i);q.onsuccess=function(){r()};q.onerror=function(){j(q.error)}})}
function dbDel(id){return new Promise(function(r,j){var q=xt('readwrite').delete(id);q.onsuccess=function(){r()};q.onerror=function(){j(q.error)}})}
function dbClr(){return new Promise(function(r,j){var q=xt('readwrite').clear();q.onsuccess=function(){r()};q.onerror=function(){j(q.error)}})}

// â•â•â• STATE â•â•â•
var ALL=[],editId=null,curAu=null,mRec=null,auCh=[],isRc=false;
var QZ=[],QI=0,QSC=0,QAd=false,QAs=[],selMC=-1;

// â•â•â• STATS/CATS â•â•â•
function stats(){
  $('sT').textContent=ALL.length;
  $('sM').textContent=ALL.filter(function(q){return q.type==='mc'}).length;
  $('sC').textContent=ALL.filter(function(q){return q.type==='classic'}).length;
  $('sA').textContent=ALL.filter(function(q){return q.type==='audio'}).length;
  $('sS').textContent=ALL.filter(function(q){return q.starred}).length;
  $('stI').textContent='IndexedDB Â· '+ALL.length+' soru';
}
function cats(){
  var cs=[];ALL.forEach(function(q){if(q.category&&cs.indexOf(q.category)===-1)cs.push(q.category)});cs.sort();
  ['fCa','qCa'].forEach(function(id){var el=$(id);if(!el)return;var cv=el.value;el.innerHTML='<option value="all">TÃ¼m Kategoriler</option>'+cs.map(function(c){return'<option value="'+esc(c)+'">'+esc(c)+'</option>'}).join('');el.value=cv});
  $('cdl').innerHTML=cs.map(function(c){return'<option value="'+esc(c)+'">'}).join('');
}

// â•â•â• NAV â•â•â•
function switchTab(t){
  document.querySelectorAll('.nb').forEach(function(b){b.classList.toggle('on',b.getAttribute('data-tab')===t)});
  document.querySelectorAll('.sec').forEach(function(s){s.classList.toggle('on',s.id==='sec-'+t)});
  if(t==='questions')renderList();
  if(t==='starred')renderStarred();
  if(t==='quiz'){$('qSt').classList.remove('hid');$('qPl').classList.add('hid');$('qRe').classList.add('hid');cats()}
}

// â•â•â• TYPE CHANGE â•â•â•
function onTypeChg(){
  var t=$('aType').value;
  $('mcO').classList.toggle('hid',t!=='mc');
  $('clA').classList.toggle('hid',t!=='classic');
  $('auS').classList.toggle('hid',t!=='audio');
}

// â•â•â• AUDIO â•â•â•
function toggleRec(){
  var btn=$('rBtn');
  if(!isRc){
    navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){
      var mime=['audio/webm;codecs=opus','audio/webm','audio/mp4','audio/wav'].find(function(t){return MediaRecorder.isTypeSupported(t)})||'';
      mRec=new MediaRecorder(stream,mime?{mimeType:mime}:{});auCh=[];
      mRec.ondataavailable=function(e){if(e.data.size>0)auCh.push(e.data)};
      mRec.onstop=function(){var blob=new Blob(auCh,{type:mRec.mimeType});stream.getTracks().forEach(function(t){t.stop()});
        toUrl(blob).then(function(u){curAu=u;showAuP(u,'Mikrofon KaydÄ±')})};
      mRec.start();isRc=true;btn.classList.add('rc');btn.textContent='â¹';
    }).catch(function(){toast('Mikrofon reddedildi!','error')});
  }else{mRec.stop();isRc=false;btn.classList.remove('rc');btn.textContent='âº'}
}
function handleAuFile(e){var f=e.target.files[0];if(!f)return;if(f.size>15*1024*1024){toast('Maks 15MB!','error');return}toUrl(f).then(function(u){curAu=u;showAuP(u,f.name)});e.target.value=''}
function toUrl(b){return new Promise(function(r){var rd=new FileReader();rd.onload=function(){r(rd.result)};rd.readAsDataURL(b)})}
function showAuP(url,name){$('auP').src=url;$('auP').classList.remove('hid');$('aZ').classList.add('has');if(name){$('auN').textContent='ğŸµ '+name;$('auN').classList.remove('hid')}toast('Ses yÃ¼klendi âœ“')}

// â•â•â• STAR â•â•â•
function toggleStar(id){
  var q=ALL.find(function(x){return x.id===id});if(!q)return;
  q.starred=!q.starred;
  dbPut(q).then(dbAll).then(function(a){ALL=a;stats();renderList();renderStarred();toast(q.starred?'â­ YÄ±ldÄ±zlandÄ±':'KaldÄ±rÄ±ldÄ±')});
}

// â•â•â• SAVE â•â•â•
function saveQ(){
  var type=$('aType').value,cat=$('aCat').value.trim()||'Genel',qtxt=$('aQ').value.trim();
  if(!qtxt){toast('Soru boÅŸ!','error');return}
  var q={id:editId||uid(),type:type,category:cat,question:qtxt,starred:false,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};
  if(editId){var ex=ALL.find(function(x){return x.id===editId});if(ex){q.createdAt=ex.createdAt;q.starred=ex.starred}}
  if(type==='mc'){var ins=$('opC').querySelectorAll('input[type=text]'),opts=Array.from(ins).map(function(i){return i.value.trim()});if(opts.some(function(o){return!o})){toast('ÅÄ±klarÄ± doldurun!','error');return}q.options=opts;q.correctIndex=parseInt(document.querySelector('input[name="co"]:checked').value)}
  else if(type==='classic'){var a=$('aAns').value.trim();if(!a){toast('Cevap girin!','error');return}q.answer=a;q.hint=$('aHint').value.trim()}
  else{var a=$('aAuA').value.trim();if(!a){toast('Cevap girin!','error');return}if(!curAu&&!editId){toast('Ses ekleyin!','error');return}q.answer=a;if(curAu)q.audioData=curAu;else if(editId){var ex=ALL.find(function(x){return x.id===editId});if(ex&&ex.audioData)q.audioData=ex.audioData}}
  dbPut(q).then(dbAll).then(function(a){ALL=a;toast(editId?'GÃ¼ncellendi âœ“':'Kaydedildi âœ“');resetForm();stats();cats()});
}
function resetForm(){
  editId=null;curAu=null;$('aType').value='mc';$('aCat').value='';$('aQ').value='';
  try{$('aAns').value='';$('aHint').value='';$('aAuA').value=''}catch(e){}
  $('opC').querySelectorAll('input[type=text]').forEach(function(i){i.value=''});
  document.querySelector('input[name="co"][value="0"]').checked=true;
  $('auP').classList.add('hid');$('auP').src='';$('auN').classList.add('hid');$('aZ').classList.remove('has');
  $('svB').textContent='ğŸ’¾ Soruyu Kaydet';onTypeChg();
}

// â•â•â• BULK â•â•â•
function parseBulk(){
  var text=$('bTxt').value.trim(),cat=$('bCat').value.trim()||'Genel';if(!text)return[];
  var lines=text.split('\n').filter(function(l){return l.trim()}),res=[];
  lines.forEach(function(line){var l=line.trim(),up=l.toUpperCase();
    if(up.indexOf('ÅIKLI:')===0||up.indexOf('SIKLI:')===0){var p=l.substring(l.indexOf(':')+1).split('|').map(function(s){return s.trim()});if(p.length>=6){var c={'A':0,'B':1,'C':2,'D':3}[p[5].toUpperCase()];res.push({type:'mc',category:cat,question:p[0],options:[p[1],p[2],p[3],p[4]],correctIndex:c||0,starred:false})}}
    else if(up.indexOf('KLASÄ°K:')===0||up.indexOf('KLASIK:')===0){var p=l.substring(l.indexOf(':')+1).split('|').map(function(s){return s.trim()});if(p.length>=2)res.push({type:'classic',category:cat,question:p[0],answer:p[1],hint:p[2]||'',starred:false})}
    else{var p=l.split('|').map(function(s){return s.trim()});if(p.length>=6){var last=p[p.length-1].toUpperCase(),c={'A':0,'B':1,'C':2,'D':3}[last];if(c!==undefined)res.push({type:'mc',category:cat,question:p[0],options:[p[1],p[2],p[3],p[4]],correctIndex:c,starred:false})}else if(p.length>=2)res.push({type:'classic',category:cat,question:p[0],answer:p[1],hint:p[2]||'',starred:false})}
  });return res}

// â•â•â• EDIT â•â•â•
function editQ(id){
  var q=ALL.find(function(x){return x.id===id});if(!q)return;editId=id;switchTab('add');
  document.querySelectorAll('.tb').forEach(function(b){b.classList.toggle('on',b.getAttribute('data-mode')==='single')});
  $('singleAdd').classList.remove('hid');$('bulkAdd').classList.add('hid');
  $('aType').value=q.type;$('aCat').value=q.category||'';$('aQ').value=q.question;onTypeChg();
  if(q.type==='mc'){var ins=$('opC').querySelectorAll('input[type=text]');q.options.forEach(function(o,i){if(ins[i])ins[i].value=o});var r=document.querySelector('input[name="co"][value="'+q.correctIndex+'"]');if(r)r.checked=true}
  else if(q.type==='classic'){$('aAns').value=q.answer||'';$('aHint').value=q.hint||''}
  else{$('aAuA').value=q.answer||'';if(q.audioData){curAu=q.audioData;showAuP(q.audioData,'Mevcut ses')}}
  $('svB').textContent='âœï¸ GÃ¼ncelle';window.scrollTo({top:0,behavior:'smooth'});
}

// â•â•â• DELETE â•â•â•
function delQ(id){
  var q=ALL.find(function(x){return x.id===id});if(!q)return;
  showModal('<h3>âš ï¸ Sil</h3><p style="color:var(--txd);font-size:.82rem;margin-bottom:13px">"'+esc(q.question.substring(0,80))+'"</p><div class="bg"><button class="btn bd bsm" data-act="confirmdel" data-id="'+id+'">Sil</button><button class="btn bo bsm" data-act="closemodal">Ä°ptal</button></div>');
}

// â•â•â• MODAL â•â•â•
function showModal(h){$('mCt').innerHTML=h;$('mOv').classList.add('show')}
function closeModal(){$('mOv').classList.remove('show')}

// â•â•â• RENDER LISTS â•â•â•
function renderList(){
  var s=$('srcI').value.toLowerCase(),tf=$('fTy').value,cf=$('fCa').value;
  var f=ALL.filter(function(q){if(tf!=='all'&&q.type!==tf)return false;if(cf!=='all'&&q.category!==cf)return false;if(s&&q.question.toLowerCase().indexOf(s)===-1)return false;return true}).sort(function(a,b){return new Date(b.createdAt)-new Date(a.createdAt)});
  var c=$('qL');if(!f.length){c.innerHTML='<div class="emp"><div class="eic">ğŸ“­</div><p>'+(ALL.length===0?'HenÃ¼z soru yok.<br>"Ekle" ile baÅŸlayÄ±n!':'SonuÃ§ bulunamadÄ±.')+'</p></div>';return}
  c.innerHTML=f.map(qH).join('');
}
function renderStarred(){
  var st=ALL.filter(function(q){return q.starred}).sort(function(a,b){return new Date(b.updatedAt)-new Date(a.updatedAt)});
  $('sBd').textContent=st.length;var c=$('sL');
  if(!st.length){c.innerHTML='<div class="emp"><div class="eic">â­</div><p>YÄ±ldÄ±zlÄ± soru yok.<br>BilemediÄŸiniz sorularÄ± yÄ±ldÄ±zlayÄ±n!</p></div>';return}
  c.innerHTML=st.map(qH).join('');
}
function qH(q){
  var ic={mc:'ğŸ“',classic:'âœï¸',audio:'ğŸµ'},cl={mc:'qic-m',classic:'qic-c',audio:'qic-a'},lb={mc:'ÅÄ±klÄ±',classic:'Klasik',audio:'Sesli'};
  return'<div class="qi'+(q.starred?' st':'')+'" data-act="preview" data-id="'+q.id+'"><div class="qic '+cl[q.type]+'">'+ic[q.type]+'</div><div class="qif"><div class="qt">'+(q.starred?'â­ ':'')+esc(q.question)+'</div><div class="qm">'+lb[q.type]+' Â· '+esc(q.category||'Genel')+' Â· '+fmtD(q.createdAt)+'</div></div><div class="qac"><button class="qb'+(q.starred?' sa':'')+'" data-act="star" data-id="'+q.id+'">'+(q.starred?'â˜…':'â˜†')+'</button><button class="qb" data-act="edit" data-id="'+q.id+'">âœï¸</button><button class="qb" data-act="del" data-id="'+q.id+'">ğŸ—‘ï¸</button></div></div>';
}
function prevQ(id){
  var q=ALL.find(function(x){return x.id===id});if(!q)return;var L=['A','B','C','D','E'];
  var h='<h3>'+esc(q.question)+'</h3><p style="font-size:.72rem;color:var(--txm);margin-bottom:13px">'+(q.type==='mc'?'ÅÄ±klÄ±':q.type==='classic'?'Klasik':'Sesli')+' Â· '+esc(q.category||'Genel')+(q.starred?' Â· â­':'')+'</p>';
  if(q.type==='mc')h+=q.options.map(function(o,i){return'<div style="padding:7px 11px;margin-bottom:3px;border-radius:8px;font-size:.84rem;'+(i===q.correctIndex?'background:rgba(0,184,148,.1);color:var(--ok);font-weight:700':'color:var(--txd)')+'">'+L[i]+') '+esc(o)+(i===q.correctIndex?' âœ“':'')+'</div>'}).join('');
  else if(q.type==='classic'){h+='<div style="padding:9px 13px;background:rgba(0,184,148,.08);border-radius:8px;margin-bottom:7px"><span style="font-size:.68rem;color:var(--txm)">CEVAP:</span><br><span style="color:var(--ok);font-weight:700">'+esc(q.answer)+'</span></div>';if(q.hint)h+='<p style="font-size:.78rem;color:var(--txd)">ğŸ’¡ '+esc(q.hint)+'</p>'}
  else{if(q.audioData)h+='<audio controls src="'+q.audioData+'" style="width:100%;margin:7px 0"></audio>';h+='<div style="padding:9px 13px;background:rgba(0,184,148,.08);border-radius:8px"><span style="font-size:.68rem;color:var(--txm)">CEVAP:</span><br><span style="color:var(--ok);font-weight:700">'+esc(q.answer)+'</span></div>'}
  h+='<div class="bg" style="margin-top:15px"><button class="btn bo bsm" data-act="closemodal">Kapat</button><button class="btn bsm '+(q.starred?'bw':'bo')+'" data-act="mstar" data-id="'+q.id+'">'+(q.starred?'â˜… KaldÄ±r':'â˜† YÄ±ldÄ±zla')+'</button><button class="btn bp bsm" data-act="medit" data-id="'+q.id+'">âœï¸ DÃ¼zenle</button></div>';
  showModal(h);
}

// â•â•â• QUIZ â•â•â•
function startQuiz(){
  var cnt=parseInt($('qCn').value)||10,tf=$('qTy').value,cf=$('qCa').value;
  var shuf=$('tSh').classList.contains('on'),starO=$('tSt').classList.contains('on');
  var pool=ALL.filter(function(q){if(tf!=='all'&&q.type!==tf)return false;if(cf!=='all'&&q.category!==cf)return false;if(starO&&!q.starred)return false;return true});
  if(!pool.length){toast('Soru yok!','error');return}
  if(shuf)pool.sort(function(){return Math.random()-.5});
  QZ=pool.slice(0,cnt);QI=0;QSC=0;QAd=false;QAs=[];
  $('qSt').classList.add('hid');$('qPl').classList.remove('hid');$('qRe').classList.add('hid');renderQzQ();
}
function renderQzQ(){
  var q=QZ[QI],tot=QZ.length,L=['A','B','C','D','E'];QAd=false;selMC=-1;
  $('pF').style.width=((QI/tot)*100)+'%';$('pT').textContent=(QI+1)+'/'+tot;
  var h='<div class="qqc"><div class="qn">Soru '+(QI+1)+'/'+tot+' Â· '+(q.type==='mc'?'ÅÄ±klÄ±':q.type==='classic'?'Klasik':'Sesli')+(q.starred?' â­':'')+'</div>';
  if(q.type==='audio'&&q.audioData)h+='<audio controls src="'+q.audioData+'" style="width:100%;margin:10px auto;max-width:400px;display:block"></audio>';
  h+='<div class="qtx">'+esc(q.question)+'</div></div>';
  if(q.type==='mc'){h+=q.options.map(function(o,i){return'<div class="qop" data-act="selmc" data-i="'+i+'"><div class="ol">'+L[i]+'</div><span>'+esc(o)+'</span></div>'}).join('');$('qAc').innerHTML='<button class="btn bp" data-act="chkmc" id="chkB" disabled>CevabÄ± Kontrol Et</button>'}
  else{if(q.hint)h+='<p style="font-size:.78rem;color:var(--txd);margin-bottom:7px;text-align:center">ğŸ’¡ '+esc(q.hint)+'</p>';h+='<input type="text" class="qin" id="qzI" placeholder="CevabÄ±nÄ±zÄ± yazÄ±n...">';$('qAc').innerHTML='<button class="btn bp" data-act="chkcl">CevabÄ± Kontrol Et</button>'}
  $('qCo').innerHTML=h;
  // Enter key for classic
  var qi=$('qzI');if(qi)qi.addEventListener('keydown',function(e){if(e.key==='Enter')chkCl()});
}
function selOpt(i){if(QAd)return;selMC=i;document.querySelectorAll('.qop').forEach(function(e,j){e.classList.toggle('sel',j===i)});$('chkB').disabled=false}
function chkMC(){if(QAd)return;QAd=true;var q=QZ[QI],ok=q.correctIndex===selMC;
  document.querySelectorAll('.qop').forEach(function(e,i){if(i===q.correctIndex)e.classList.add('ok');if(i===selMC&&!ok)e.classList.add('no');e.style.pointerEvents='none'});
  if(ok)QSC++;if(!ok&&!q.starred)autoStar(q.id);QAs.push({question:q,ua:selMC,ok:ok});nxtBtn()}
function chkCl(){if(QAd)return;QAd=true;var q=QZ[QI],inp=$('qzI'),ua=inp.value.trim(),ok=ua.toLowerCase()===q.answer.toLowerCase();
  inp.disabled=true;inp.style.borderColor=ok?'var(--ok)':'var(--no)';
  if(!ok)$('qCo').insertAdjacentHTML('beforeend','<div style="text-align:center;padding:10px;color:var(--ok);font-size:.88rem">DoÄŸru: <strong>'+esc(q.answer)+'</strong></div>');
  if(ok)QSC++;if(!ok&&!q.starred)autoStar(q.id);QAs.push({question:q,ua:ua,ok:ok});nxtBtn()}
function autoStar(id){var q=ALL.find(function(x){return x.id===id});if(q&&!q.starred){q.starred=true;dbPut(q).then(dbAll).then(function(a){ALL=a;stats()})}}
function nxtBtn(){var q=QZ[QI];var sb='<button class="btn bsm '+(q.starred?'bw':'bo')+'" data-act="qstar" data-id="'+q.id+'">'+(q.starred?'â˜… KaldÄ±r':'â˜† YÄ±ldÄ±zla')+'</button>';
  $('qAc').innerHTML='<div class="bg" style="justify-content:center">'+sb+(QI<QZ.length-1?'<button class="btn bp" data-act="nextq">Sonraki â†’</button>':'<button class="btn bs" data-act="showres">SonuÃ§lar ğŸ†</button>')+'</div>'}
function showRes(){
  $('qPl').classList.add('hid');var r=$('qRe');r.classList.remove('hid');
  var tot=QZ.length,wr=tot-QSC,pct=Math.round((QSC/tot)*100),em=pct<50?'ğŸ’ª':pct<75?'ğŸ‘':pct<100?'ğŸŒŸ':'ğŸ†',L=['A','B','C','D','E'];
  var h='<div class="cd" style="text-align:center;padding:32px 18px"><div style="font-size:2.6rem;margin-bottom:5px">'+em+'</div><div class="rsc">%'+pct+'</div><div style="font-size:.9rem;color:var(--txd);margin-top:4px">BaÅŸarÄ± OranÄ±</div><div class="rbd"><div class="ri ck"><div class="rn">'+QSC+'</div><div class="rl">DoÄŸru</div></div><div class="ri cn"><div class="rn">'+wr+'</div><div class="rl">YanlÄ±ÅŸ</div></div><div class="ri"><div class="rn" style="color:var(--tx)">'+tot+'</div><div class="rl">Toplam</div></div></div><p style="font-size:.74rem;color:var(--txd);margin-bottom:13px">â­ YanlÄ±ÅŸlar otomatik yÄ±ldÄ±zlandÄ±</p><div class="bg" style="justify-content:center"><button class="btn bp" data-act="startq">ğŸ”„ Tekrar</button><button class="btn bo" data-act="resetq">âš™ï¸ Ayarlar</button></div></div>';
  h+='<div class="cd" style="margin-top:12px"><div class="ct">ğŸ“Š Detaylar</div>';
  QAs.forEach(function(a,i){var q=a.question,ic=a.ok?'âœ…':'âŒ',d='';if(q.type==='mc'){d=a.ok?L[a.ua]:L[a.ua]+' â†’ '+L[q.correctIndex]}else{d=a.ok?a.ua:'"'+a.ua+'" â†’ "'+q.answer+'"'}
    h+='<div style="padding:9px 0;border-bottom:1px solid var(--bd);font-size:.81rem">'+ic+' <strong>'+(i+1)+'.</strong> '+esc(q.question.substring(0,55))+(q.question.length>55?'...':'')+'<div style="color:var(--txd);font-size:.73rem;margin-top:2px">'+esc(d)+'</div></div>'});
  h+='</div>';r.innerHTML=h;
}

// â•â•â• IO â•â•â•
function exportData(){if(!ALL.length){toast('Soru yok!','error');return}var d={app:'BilgiYarismasi',version:2,exportDate:new Date().toISOString(),count:ALL.length,questions:ALL};var a=document.createElement('a');a.href=URL.createObjectURL(new Blob([JSON.stringify(d,null,2)],{type:'application/json'}));a.download='bilgi-'+new Date().toISOString().slice(0,10)+'.json';a.click();toast(ALL.length+' soru aktarÄ±ldÄ± âœ“')}
function handleImport(e){var f=e.target.files[0];if(!f)return;f.text().then(function(t){var d=JSON.parse(t);var qs=d.questions||(Array.isArray(d)?d:[]);qs=qs.filter(function(q){return q.type&&q.question});if(!qs.length){toast('Soru yok!','error');return}window._imp=qs;
  showModal('<h3>ğŸ“¥ Ä°Ã§e Aktar</h3><p style="color:var(--txd);font-size:.84rem;margin-bottom:13px">'+qs.length+' soru bulundu.</p><div class="bg"><button class="btn bp bsm" data-act="doimp" data-mode="merge">BirleÅŸtir</button><button class="btn bd bsm" data-act="doimp" data-mode="replace">DeÄŸiÅŸtir</button><button class="btn bo bsm" data-act="closemodal">Ä°ptal</button></div>')}).catch(function(){toast('OkunamadÄ±!','error')});e.target.value=''}
function doImp(m){var qs=window._imp;if(!qs)return;var chain=m==='replace'?dbClr():Promise.resolve();qs.forEach(function(q){if(m==='merge')q.id=uid();if(!q.createdAt)q.createdAt=new Date().toISOString();if(q.starred===undefined)q.starred=false;chain=chain.then(function(){return dbPut(q)})});chain.then(dbAll).then(function(a){ALL=a;closeModal();stats();cats();renderList();renderStarred();toast(qs.length+' soru aktarÄ±ldÄ± âœ“');window._imp=null})}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MASTER EVENT DELEGATION - iOS compatible
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('click',function(e){
  var el=e.target.closest('[data-act]');
  if(!el)return;
  var act=el.getAttribute('data-act');
  var id=el.getAttribute('data-id');
  var mode=el.getAttribute('data-mode');

  switch(act){
    // Theme
    case'theme':
      localStorage.setItem('qt',document.body.classList.contains('light')?'dark':'light');
      applyTheme();break;
    // Nav
    case'tab':break; // handled below
    // Stars
    case'star':e.stopPropagation();toggleStar(id);break;
    case'mstar':closeModal();toggleStar(id);break;
    case'qstar':toggleStar(id);nxtBtn();break;
    // Preview
    case'preview':prevQ(id);break;
    // Edit/Del
    case'edit':e.stopPropagation();editQ(id);break;
    case'medit':closeModal();editQ(id);break;
    case'del':e.stopPropagation();delQ(id);break;
    case'confirmdel':dbDel(id).then(dbAll).then(function(a){ALL=a;closeModal();stats();cats();renderList();renderStarred();toast('Silindi')});break;
    // Modal
    case'closemodal':closeModal();break;
    // Save
    case'save':saveQ();break;
    // Add mode
    case'addmode':
      document.querySelectorAll('.tb').forEach(function(b){b.classList.toggle('on',b===el)});
      $('singleAdd').classList.toggle('hid',mode==='bulk');$('bulkAdd').classList.toggle('hid',mode==='single');break;
    // Bulk
    case'bprev':
      var qs=parseBulk(),bel=$('bPrev');if(!qs.length){bel.classList.add('hid');toast('Soru yok!','error');break}bel.classList.remove('hid');
      bel.innerHTML='<div class="cd" style="padding:13px"><div class="ct">ğŸ‘ï¸ Ã–nizleme ('+qs.length+')</div>'+qs.map(function(q,i){return'<div style="padding:7px 0;border-bottom:1px solid var(--bd);font-size:.8rem"><strong>'+(i+1)+'.</strong> '+esc(q.question)+' <span style="color:var(--txm)">['+(q.type==='mc'?'ÅÄ±klÄ±':'Klasik')+']</span><div style="color:var(--ok);font-size:.74rem;margin-top:2px">âœ“ '+esc(q.type==='mc'?q.options[q.correctIndex]:q.answer)+'</div></div>'}).join('')+'</div>';break;
    case'bsave':
      var qs=parseBulk();if(!qs.length){toast('Soru yok!','error');break}var ch=Promise.resolve();qs.forEach(function(q){q.id=uid();q.createdAt=new Date().toISOString();q.updatedAt=new Date().toISOString();ch=ch.then(function(){return dbPut(q)})});ch.then(dbAll).then(function(a){ALL=a;stats();cats();renderList();$('bTxt').value='';$('bPrev').classList.add('hid');toast(qs.length+' soru eklendi âœ“')});break;
    // Audio
    case'rec':toggleRec();break;
    case'aufile':$('auF').click();break;
    // Toggle
    case'tog':el.classList.toggle('on');break;
    // Quiz
    case'startq':startQuiz();break;
    case'starquiz':
      var st=ALL.filter(function(q){return q.starred});if(!st.length){toast('YÄ±ldÄ±zlÄ± soru yok!','error');break}
      switchTab('quiz');$('tSt').classList.add('on');setTimeout(startQuiz,100);break;
    case'resetq':$('qSt').classList.remove('hid');$('qPl').classList.add('hid');$('qRe').classList.add('hid');cats();break;
    case'selmc':selOpt(parseInt(el.getAttribute('data-i')));break;
    case'chkmc':chkMC();break;
    case'chkcl':chkCl();break;
    case'nextq':QI++;renderQzQ();break;
    case'showres':showRes();break;
    // IO
    case'export':exportData();break;
    case'import':$('impF').click();break;
    case'doimp':doImp(mode);break;
    case'clearall':showModal('<h3>âš ï¸ TÃ¼mÃ¼nÃ¼ Sil</h3><p style="color:var(--txd);font-size:.84rem;margin-bottom:13px">'+ALL.length+' soru silinecek!</p><div class="bg"><button class="btn bd bsm" data-act="confirmclr">Sil</button><button class="btn bo bsm" data-act="closemodal">Ä°ptal</button></div>');break;
    case'confirmclr':dbClr().then(function(){ALL=[];closeModal();stats();cats();renderList();renderStarred();toast('Silindi')});break;
  }
},true); // useCapture=true for iOS

// Nav buttons
document.querySelectorAll('.nb[data-tab]').forEach(function(b){
  b.addEventListener('click',function(){switchTab(b.getAttribute('data-tab'))},true);
});

// Modal backdrop
$('mOv').addEventListener('click',function(e){if(e.target===e.currentTarget)closeModal()},true);

// File inputs
$('auF').addEventListener('change',handleAuFile);
$('impF').addEventListener('change',handleImport);
// Select change
$('aType').addEventListener('change',onTypeChg);
$('srcI').addEventListener('input',renderList);
$('fTy').addEventListener('change',renderList);
$('fCa').addEventListener('change',renderList);

// â•â•â• INIT â•â•â•
openDB().then(dbAll).then(function(a){ALL=a;var ch=Promise.resolve();ALL.forEach(function(q){if(q.starred===undefined){q.starred=false;ch=ch.then(function(){return dbPut(q)})}});return ch.then(dbAll)}).then(function(a){ALL=a;stats();cats();renderList()}).catch(function(){toast('DB hatasÄ±!','error')});

})();
</script>
</body>
</html>
